<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Get Started • bayesm.HART</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get Started">
<!-- Copyright (c) 2000-2023 etracker GmbH. All rights reserved. --><!-- This material may not be reproduced, displayed, modified or distributed --><!-- without the express prior written permission of the copyright holder. --><!-- etracker tracklet 5.0 --><script type="text/javascript">
// var et_pagename = "";
// var et_areas = "";
// var et_tval = 0;
// var et_tsale = 0;
// var et_tonr = "";
// var et_basket = "";
</script><script id="_etLoader" type="text/javascript" charset="UTF-8" data-block-cookies="true" data-secure-code="6ggnmg" src="//code.etracker.com/code/e.js" async></script><!-- etracker tracklet 5.0 end --><!-- math rendering issues  https://github.com/r-lib/pkgdown/issues/2704 --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bayesm.HART</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/bayesm-HART.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/bayesm-HART.html">Get Started</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Get Started</h1>
            
            <h4 data-toc-skip class="date">2025-06-29</h4>
      

      <div class="d-none name"><code>bayesm-HART.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette illustrates how to estimate a hierarchical logit model
with HART priors using the <code>bayesm.HART</code> package. Following
Application I in Wiemann (2025), the HART logit model is applied to the
<code>bank</code> conjoint dataset of Allenby and Ginter (1995) on
out-of-state credit card design.</p>
<p>The key feature of the <code>bayesm.HART</code> package is the use of
a Hierarchical Additive Regression Tree (HART) prior. This allows for a
flexible, non-parametric specification of the <em>representative
consumer</em> as a function of observed characteristics. This vignette
contrasts the HART logit model with a conventional hierarchical logit
model that specifies the representative consumer as a linear function of
characteristics.</p>
<p>The rest of the vignette proceeds as follows: 1. Load and prepare
data for use with <code>bayesm</code> and <code>bayesm.HART</code> 2.
Run MCMC chains for fully Bayesian inference 3. Posterior inference on
respondent-level part-worths 4. Posterior inference on consumer segment
part-worths</p>
</div>
<div class="section level2">
<h2 id="conjoint-data-of-allenby-and-ginter-1995">Conjoint Data of Allenby and Ginter (1995)<a class="anchor" aria-label="anchor" href="#conjoint-data-of-allenby-and-ginter-1995"></a>
</h2>
<p>To illustrate the HART logit model, we load the <code>bank</code>
dataset included with the <code>bayesm</code> package and originally
considered in Allenby and Ginter (1995). The dataset contains responses
from 946 customers of a regional bank collected in a telephone conjoint
on credit card attributes. The bank’s main motivation stemmed from an
effort to expand to customers in a new market (“out-of-state”). Each
respondent offered between 13 and 17 responses to hypothetical choices
between two credit cards that were identical in all considered
attributes except for two that varied. In total, the dataset contains
14,799 binary responses as well as the respondents’ age, income, and
gender.</p>
<p>The code snippet below prepares the data for use with
<code>bayesm</code> and <code>bayesm.HART</code>. Both packages take the
same data structure, allowing researchers familiar with the
<code>bayesm</code> package to get started quickly.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load dependencies</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">bayesm.HART</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">bayesm</span><span class="op">)</span></span>
<span><span class="co"># Data wrangling and plotting utilities</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load and prepare data from the 'bank' dataset (same as bayesm)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">bank</span><span class="op">)</span></span>
<span><span class="va">choiceAtt</span> <span class="op">&lt;-</span> <span class="va">bank</span><span class="op">$</span><span class="va">choiceAtt</span></span>
<span><span class="va">hh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">choiceAtt</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nhh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">hh</span><span class="op">)</span></span>
<span><span class="va">lgtdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, length <span class="op">=</span> <span class="va">nhh</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nhh</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">y</span> <span class="op">=</span> <span class="fl">2</span> <span class="op">-</span> <span class="va">choiceAtt</span><span class="op">[</span><span class="va">choiceAtt</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">==</span><span class="va">hh</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">nobs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span>    <span class="va">X_temp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">choiceAtt</span><span class="op">[</span><span class="va">choiceAtt</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">==</span><span class="va">hh</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X_temp</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X_temp</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">X</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="op">]</span> <span class="op">=</span> <span class="va">X_temp</span></span>
<span>    <span class="va">lgtdata</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span>, X<span class="op">=</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">bank</span><span class="op">$</span><span class="va">demo</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># omit id</span></span>
<span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span><span class="op">)</span> <span class="co"># de-mean covariates as required by bayesm</span></span>
<span></span>
<span><span class="co"># Final data object (same as bayesm)</span></span>
<span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lgtdata <span class="op">=</span> <span class="va">lgtdata</span>, Z <span class="op">=</span> <span class="va">Z</span>, p <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="mcmc-estimation">MCMC Estimation<a class="anchor" aria-label="anchor" href="#mcmc-estimation"></a>
</h2>
<p>We apply two demand models to the conjoint data: the HART logit model
proposed by Wiemann (2025) and a conventional linear hierarchical logit
model (e.g., Rossi et al., 2009). Both models are motivated by a latent
utility model of consumer choice, where each respondent chooses the
credit card profile that maximizes their utility. The only difference
between the HART and linear hierarchical specifications is their model
of preference heterogeneity. The linear approach models the relationship
between a respondent’s characteristics as a linear function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Δ</mi><mi>⊤</mi></msup><msub><mi>Z</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\Delta^\top Z_i</annotation></semantics></math>
while the HART model uses a sum-of-trees factor model
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Z</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Delta(Z_i)</annotation></semantics></math>
that allows for rich nonlinearities and interactions.</p>
<p>The code snippet below specifies the MCMC hyperparameters. To speed
up the code runtime, a short MCMC chain with only 5000 iterations is
considered. Longer chains should be run in practice. We then sample from
the posterior distribution of both models by calling
<code>rhierMnlRwMixture</code>. The only difference in syntax is the
additional prior argument <code>bart</code>. For simplicity, the code
below specifies a HART model with only 20 trees per factor, leaving all
other hyperparameters at their defaults. See also
<code><a href="../reference/rhierMnlRwMixture.html">?rhierMnlRwMixture</a></code> for details.</p>
<p>A simple way to check for convergence is to plot the log-likelihood
over MCMC iterations. The plot below indicates convergence of both MCMC
chains within just a few iterations.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">burnin_draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">burn</span> <span class="op">/</span> <span class="va">keep</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">mcmc_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Iteration <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">out_hart</span><span class="op">$</span><span class="va">loglike</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="va">keep</span>,</span>
<span>  HART <span class="op">=</span> <span class="va">out_hart</span><span class="op">$</span><span class="va">loglike</span>,</span>
<span>  Linear <span class="op">=</span> <span class="va">out_lin</span><span class="op">$</span><span class="va">loglike</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HART"</span>, <span class="st">"Linear"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"Model"</span>, values_to <span class="op">=</span> <span class="st">"LogLikelihood"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mcmc_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Iteration</span>, y <span class="op">=</span> <span class="va">LogLikelihood</span>, color <span class="op">=</span> <span class="va">Model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">burn</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HART"</span> <span class="op">=</span> <span class="st">"blue"</span>, <span class="st">"Linear"</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Log-Likelihood Trace Plots"</span>, x <span class="op">=</span> <span class="st">"MCMC Iteration"</span>, y <span class="op">=</span> <span class="st">"Log-Likelihood"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>        legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figures/mcmc-diagnostics-1.png" alt="MCMC Traceplot of the Log Likelihood." width="90%"><p class="caption">
MCMC Traceplot of the Log Likelihood.
</p>
</div>
</div>
<div class="section level2">
<h2 id="posterior-inference-about-respondent-level-part-worths">Posterior Inference about Respondent-level Part-Worths<a class="anchor" aria-label="anchor" href="#posterior-inference-about-respondent-level-part-worths"></a>
</h2>
<p>With the MCMC draws from both models, we can characterize the
posterior estimates for individual-level coefficients, or part-worths.
These coefficients represent respondent-specific preferences for each
credit card attribute. To illustrate the differences between the HART
and linear hierarchical approaches, we examine the posterior
distributions for two respondents: Respondent 146 is an older woman with
low income, while respondent 580 is a middle-aged man with moderate
income. The comparison focuses on the out-of-state bank attribute, which
represents a key design challenge for the bank’s expansion strategy.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selected_resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">146</span>, <span class="fl">580</span><span class="op">)</span></span>
<span><span class="va">coef_indx</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co"># "Interest" coefficient</span></span>
<span><span class="va">coef_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">bank</span><span class="op">$</span><span class="va">choiceAtt</span><span class="op">[</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">16</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="va">coef_indx</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Create a combined factor for filling histograms</span></span>
<span><span class="va">beta_draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">out_hart</span><span class="op">$</span><span class="va">betadraw</span><span class="op">[</span><span class="va">selected_resp</span>, <span class="va">coef_indx</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">burnin_draws</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Model <span class="op">=</span> <span class="st">"HART"</span>, Draw <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">out_lin</span><span class="op">$</span><span class="va">betadraw</span><span class="op">[</span><span class="va">selected_resp</span>, <span class="va">coef_indx</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">burnin_draws</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Model <span class="op">=</span> <span class="st">"Linear"</span>, Draw <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">beta_draws</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Respondent"</span>, <span class="va">selected_resp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">beta_draws_long</span> <span class="op">&lt;-</span> <span class="va">beta_draws</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"Respondent"</span><span class="op">)</span>, </span>
<span>    names_to <span class="op">=</span> <span class="st">"Respondent"</span>, </span>
<span>    values_to <span class="op">=</span> <span class="st">"Coefficient"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      Model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Model</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Linear"</span>, <span class="st">"HART"</span><span class="op">)</span><span class="op">)</span>, <span class="co"># Control facet order</span></span>
<span>      Group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">Respondent</span>, <span class="va">Model</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Define colors</span></span>
<span><span class="va">model_fills</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Respondent 146.Linear"</span> <span class="op">=</span> <span class="st">"lightcoral"</span>, <span class="st">"Respondent 580.Linear"</span> <span class="op">=</span> <span class="st">"darkred"</span>,</span>
<span>    <span class="st">"Respondent 146.HART"</span> <span class="op">=</span> <span class="st">"lightblue"</span>, <span class="st">"Respondent 580.HART"</span> <span class="op">=</span> <span class="st">"darkblue"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">model_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Respondent 146.Linear"</span> <span class="op">=</span> <span class="st">"red"</span>, <span class="st">"Respondent 580.Linear"</span> <span class="op">=</span> <span class="st">"darkred"</span>,</span>
<span>    <span class="st">"Respondent 146.HART"</span> <span class="op">=</span> <span class="st">"blue"</span>, <span class="st">"Respondent 580.HART"</span> <span class="op">=</span> <span class="st">"darkblue"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate means</span></span>
<span><span class="va">means</span> <span class="op">&lt;-</span> <span class="va">beta_draws_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Group</span>, <span class="va">Model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Coefficient</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">beta_draws_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Coefficient</span>, fill <span class="op">=</span> <span class="va">Group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.6</span>, bins <span class="op">=</span> <span class="fl">45</span>, </span>
<span>                 position <span class="op">=</span> <span class="st">"identity"</span>, color <span class="op">=</span> <span class="st">"black"</span>, linewidth <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">means</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">mean_val</span>, color <span class="op">=</span> <span class="va">Group</span><span class="op">)</span>,</span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span>, linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Model</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Respondent"</span>, values <span class="op">=</span> <span class="va">model_fills</span>,</span>
<span>                    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Respondent 146.Linear"</span>, <span class="st">"Respondent 580.Linear"</span>, </span>
<span>                               <span class="st">"Respondent 146.HART"</span>, <span class="st">"Respondent 580.HART"</span><span class="op">)</span>,</span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Respondent 146"</span>, <span class="st">"Respondent 580"</span>, </span>
<span>                               <span class="st">"Respondent 146"</span>, <span class="st">"Respondent 580"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">model_colors</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey90"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Selected Posterior Distributions of Individual Out-of-State Part-Worths"</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Coefficient Value"</span>, y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figures/individual-betas-1.png" alt="Posterior Distributions of Individual-level Part-Worths." width="90%"><p class="caption">
Posterior Distributions of Individual-level Part-Worths.
</p>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract posterior draws for the selected respondents and coefficient</span></span>
<span><span class="va">hart_draws_146</span> <span class="op">&lt;-</span> <span class="va">out_hart</span><span class="op">$</span><span class="va">betadraw</span><span class="op">[</span><span class="fl">146</span>, <span class="va">coef_indx</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">burnin_draws</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">hart_draws_580</span> <span class="op">&lt;-</span> <span class="va">out_hart</span><span class="op">$</span><span class="va">betadraw</span><span class="op">[</span><span class="fl">580</span>, <span class="va">coef_indx</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">burnin_draws</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">lin_draws_146</span> <span class="op">&lt;-</span> <span class="va">out_lin</span><span class="op">$</span><span class="va">betadraw</span><span class="op">[</span><span class="fl">146</span>, <span class="va">coef_indx</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">burnin_draws</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">lin_draws_580</span> <span class="op">&lt;-</span> <span class="va">out_lin</span><span class="op">$</span><span class="va">betadraw</span><span class="op">[</span><span class="fl">580</span>, <span class="va">coef_indx</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">burnin_draws</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Create summary table</span></span>
<span><span class="va">summary_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Linear"</span>, <span class="st">"Linear"</span>, <span class="st">"HART"</span>, <span class="st">"HART"</span><span class="op">)</span>,</span>
<span>  Respondent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"146"</span>, <span class="st">"580"</span>, <span class="st">"146"</span>, <span class="st">"580"</span><span class="op">)</span>,</span>
<span>  Mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lin_draws_146</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lin_draws_580</span><span class="op">)</span>, </span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">hart_draws_146</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">hart_draws_580</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  SD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">lin_draws_146</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">lin_draws_580</span><span class="op">)</span>, </span>
<span>         <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">hart_draws_146</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">hart_draws_580</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">summary_results</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Model Respondent   Mean   SD</span></span>
<span><span class="co">#&gt; 1 Linear        146 -7.293 2.88</span></span>
<span><span class="co">#&gt; 2 Linear        580 -1.432 2.52</span></span>
<span><span class="co">#&gt; 3   HART        146 -8.194 2.75</span></span>
<span><span class="co">#&gt; 4   HART        580 -0.511 2.72</span></span></code></pre></div>
<p>The posterior distributions show that both models produce similar
individual-level part-worth estimates for these two respondents. This
similarity is expected and reflects a key feature of hierarchical
models: when respondents have many choice profiles (as is the case
here), their individual-level posterior estimates are primarily driven
by their own choice data rather than the first-stage prior. Both
respondents have between 13 and 17 choice profiles, providing
substantial individual-level information that dominates the influence of
the first-stage prior specification.</p>
<p>The real differences between HART and linear hierarchical models
emerge in settings with limited individual-level data, or when
characterizing the representative consumer for new segments—precisely
the scenario of central interest for the bank’s expansion plans in
Allenby and Ginter (1995). The next section explores these differences
by examining the representative consumer estimates.</p>
</div>
<div class="section level2">
<h2 id="posterior-inference-on-consumer-segment-part-worths">Posterior Inference on Consumer Segment Part-Worths<a class="anchor" aria-label="anchor" href="#posterior-inference-on-consumer-segment-part-worths"></a>
</h2>
<p>As established in the previous section, the real differences between
HART and linear hierarchical models emerge when characterizing the
representative consumer for new segments—precisely the scenario of
central interest for the bank’s expansion plans. The model estimates how
part-worths vary with demographics <code>Z</code>, where the term
<code>Delta(Z)</code> represents the expected part-worth for a
“representative” respondent with characteristics <code>Z</code>.</p>
<p>To illustrate these differences, we focus on two granularly-defined
consumer segments. Segment 1 is defined as older female respondents with
low income, while Segment 2 is defined as middle-aged male respondents
with moderate income. These segments are selected because they allow for
illustration of substantial differences between conventional linear and
HART logit models. We can use the <code>predict</code> function to get
the posterior draws for <code>Delta(Z)</code> for these selected
segments.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We predict for all respondents</span></span>
<span><span class="va">DeltaZ_hat_hart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">out_hart</span>, newdata <span class="op">=</span> <span class="va">Data</span>, type <span class="op">=</span> <span class="st">"DeltaZ+mu"</span>, burn <span class="op">=</span> <span class="va">burn</span><span class="op">)</span></span>
<span><span class="co">#&gt; Predicting coefficient 1 with BART model</span></span>
<span><span class="co">#&gt; Predicting coefficient 2 with BART model</span></span>
<span><span class="co">#&gt; Predicting coefficient 3 with BART model</span></span>
<span><span class="co">#&gt; Predicting coefficient 4 with BART model</span></span>
<span><span class="co">#&gt; Predicting coefficient 5 with BART model</span></span>
<span><span class="co">#&gt; Predicting coefficient 6 with BART model</span></span>
<span><span class="co">#&gt; Predicting coefficient 7 with BART model</span></span>
<span><span class="co">#&gt; Predicting coefficient 8 with BART model</span></span>
<span><span class="co">#&gt; Predicting coefficient 9 with BART model</span></span>
<span><span class="co">#&gt; Predicting coefficient 10 with BART model</span></span>
<span><span class="co">#&gt; Predicting coefficient 11 with BART model</span></span>
<span><span class="co">#&gt; Predicting coefficient 12 with BART model</span></span>
<span><span class="co">#&gt; Predicting coefficient 13 with BART model</span></span>
<span><span class="co">#&gt; Predicting coefficient 14 with BART model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">out_lin</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"rhierMnlRwMixture"</span> <span class="co"># allows bayesm model to use bayesm.HART methods </span></span>
<span><span class="va">DeltaZ_hat_lin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">out_lin</span>, newdata <span class="op">=</span> <span class="va">Data</span>, type <span class="op">=</span> <span class="st">"DeltaZ+mu"</span>, burn <span class="op">=</span> <span class="va">burn</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">deltaZ_draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">DeltaZ_hat_hart</span><span class="op">[</span><span class="va">selected_resp</span>, <span class="va">coef_indx</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Model <span class="op">=</span> <span class="st">"HART"</span>, Draw <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">DeltaZ_hat_lin</span><span class="op">[</span><span class="va">selected_resp</span>, <span class="va">coef_indx</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Model <span class="op">=</span> <span class="st">"Linear"</span>, Draw <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">deltaZ_draws</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Segment 1"</span>, <span class="st">"Segment 2"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">deltaZ_draws_long</span> <span class="op">&lt;-</span> <span class="va">deltaZ_draws</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"Segment"</span><span class="op">)</span>, </span>
<span>    names_to <span class="op">=</span> <span class="st">"Consumer_Segment"</span>, </span>
<span>    values_to <span class="op">=</span> <span class="st">"Coefficient"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      Model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Model</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Linear"</span>, <span class="st">"HART"</span><span class="op">)</span><span class="op">)</span>, <span class="co"># Control facet order</span></span>
<span>      Group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">Consumer_Segment</span>, <span class="va">Model</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Update color definitions to match segment terminology</span></span>
<span><span class="va">model_fills</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Segment 1.Linear"</span> <span class="op">=</span> <span class="st">"lightcoral"</span>, <span class="st">"Segment 2.Linear"</span> <span class="op">=</span> <span class="st">"darkred"</span>,</span>
<span>    <span class="st">"Segment 1.HART"</span> <span class="op">=</span> <span class="st">"lightblue"</span>, <span class="st">"Segment 2.HART"</span> <span class="op">=</span> <span class="st">"darkblue"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">model_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Segment 1.Linear"</span> <span class="op">=</span> <span class="st">"red"</span>, <span class="st">"Segment 2.Linear"</span> <span class="op">=</span> <span class="st">"darkred"</span>,</span>
<span>    <span class="st">"Segment 1.HART"</span> <span class="op">=</span> <span class="st">"blue"</span>, <span class="st">"Segment 2.HART"</span> <span class="op">=</span> <span class="st">"darkblue"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate means</span></span>
<span><span class="va">means_deltaZ</span> <span class="op">&lt;-</span> <span class="va">deltaZ_draws_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Group</span>, <span class="va">Model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Coefficient</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">deltaZ_draws_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Coefficient</span>, fill <span class="op">=</span> <span class="va">Group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.6</span>, bins <span class="op">=</span> <span class="fl">45</span>, </span>
<span>                 position <span class="op">=</span> <span class="st">"identity"</span>, color <span class="op">=</span> <span class="st">"black"</span>, linewidth <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">means_deltaZ</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">mean_val</span>, color <span class="op">=</span> <span class="va">Group</span><span class="op">)</span>,</span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span>, linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Model</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Consumer Segment"</span>, values <span class="op">=</span> <span class="va">model_fills</span>,</span>
<span>                    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Segment 1.Linear"</span>, <span class="st">"Segment 2.Linear"</span>, </span>
<span>                               <span class="st">"Segment 1.HART"</span>, <span class="st">"Segment 2.HART"</span><span class="op">)</span>,</span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Segment 1"</span>, <span class="st">"Segment 2"</span>, </span>
<span>                               <span class="st">"Segment 1"</span>, <span class="st">"Segment 2"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">model_colors</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey90"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Posterior Distributions of Expected Out-of-State Part-Worths"</span>,</span>
<span>     x <span class="op">=</span> <span class="st">"Coefficient Value"</span>, y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figures/representative-respondent-1.png" alt="Posterior Distributions of Expected Part-Worths." width="90%"><p class="caption">
Posterior Distributions of Expected Part-Worths.
</p>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract expected part-worths for the two segments</span></span>
<span><span class="va">deltaZ_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Segment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Segment 1 (Older Women, Low Income)"</span>, </span>
<span>              <span class="st">"Segment 2 (Middle-aged Men, Moderate Income)"</span><span class="op">)</span>,</span>
<span>  Linear_Mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">DeltaZ_hat_lin</span><span class="op">[</span><span class="fl">146</span>, <span class="va">coef_indx</span>, <span class="op">]</span><span class="op">)</span>, </span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">DeltaZ_hat_lin</span><span class="op">[</span><span class="fl">580</span>, <span class="va">coef_indx</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Linear_SD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">DeltaZ_hat_lin</span><span class="op">[</span><span class="fl">146</span>, <span class="va">coef_indx</span>, <span class="op">]</span><span class="op">)</span>, </span>
<span>                <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">DeltaZ_hat_lin</span><span class="op">[</span><span class="fl">580</span>, <span class="va">coef_indx</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  HART_Mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">DeltaZ_hat_hart</span><span class="op">[</span><span class="fl">146</span>, <span class="va">coef_indx</span>, <span class="op">]</span><span class="op">)</span>, </span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">DeltaZ_hat_hart</span><span class="op">[</span><span class="fl">580</span>, <span class="va">coef_indx</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  HART_SD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">DeltaZ_hat_hart</span><span class="op">[</span><span class="fl">146</span>, <span class="va">coef_indx</span>, <span class="op">]</span><span class="op">)</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">DeltaZ_hat_hart</span><span class="op">[</span><span class="fl">580</span>, <span class="va">coef_indx</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">deltaZ_summary</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                        Segment Linear_Mean Linear_SD</span></span>
<span><span class="co">#&gt; 1          Segment 1 (Older Women, Low Income)       -3.90     0.637</span></span>
<span><span class="co">#&gt; 2 Segment 2 (Middle-aged Men, Moderate Income)       -3.74     0.425</span></span>
<span><span class="co">#&gt;   HART_Mean HART_SD</span></span>
<span><span class="co">#&gt; 1     -5.38   0.976</span></span>
<span><span class="co">#&gt; 2     -2.86   0.624</span></span>
<span></span>
<span><span class="co"># Calculate differences between segments</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nDifferences between segments:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Differences between segments:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Linear approach difference:"</span>, </span>
<span>    <span class="va">deltaZ_summary</span><span class="op">$</span><span class="va">Linear_Mean</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">deltaZ_summary</span><span class="op">$</span><span class="va">Linear_Mean</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linear approach difference: 0.1555552</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"HART approach difference:"</span>, </span>
<span>    <span class="va">deltaZ_summary</span><span class="op">$</span><span class="va">HART_Mean</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">deltaZ_summary</span><span class="op">$</span><span class="va">HART_Mean</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; HART approach difference: 2.520084</span></span></code></pre></div>
<p>The posterior distributions reveal economically important differences
between the HART and linear hierarchical approaches. The conventional
linear approach finds only moderate differences in the expected
part-worths between the two segments. In stark contrast, HART finds
substantially different preferences for the two segments. Where the
linear specification averages over any nonlinearities and interactions,
the HART model captures richer heterogeneity. This enhanced ability to
differentiate between consumer segments represents a key advantage of
the HART approach when granular understanding of preference
heterogeneity is required for targeting new market segments.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Allenby, Greg M. and James L. Ginter (1995). “Using Extremes to
Design Products and Segment Markets.” Journal of Marketing Research
32.4, pp. 392–403.</p>
<p>Rossi, Peter E., Greg M. Allenby, and Robert McCulloch (2009).
Bayesian Statistics and Marketing. Reprint. Wiley Series in Probability
and Statistics. Chichester: Wiley.</p>
<p>Wiemann, Thomas (2025). “<a href="https://thomaswiemann.com/assets/pdfs/jmp_wiemann.pdf" class="external-link">Personalization
with HART</a>.” Working paper.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Wiemann.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
